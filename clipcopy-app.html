<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClipCopy App</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='8' fill='%230d0f14'/%3E%3Crect x='1' y='1' width='30' height='30' rx='7.5' fill='none' stroke='%235b8fff' stroke-width='1' stroke-opacity='0.3'/%3E%3Crect x='12' y='4' width='8' height='5' rx='1.5' fill='%235b8fff'/%3E%3Crect x='12' y='4' width='8' height='5' rx='1.5' fill='url(%23g)'/%3E%3Cpath d='M20 6h3a2.5 2.5 0 012.5 2.5v17A2.5 2.5 0 0123 28H9a2.5 2.5 0 01-2.5-2.5v-17A2.5 2.5 0 019 6h3' stroke='%235b8fff' stroke-width='1.8' stroke-linecap='round' fill='none'/%3E%3Cpath d='M11 16h10M11 20h7' stroke='%23a78bfa' stroke-width='1.8' stroke-linecap='round'/%3E%3Cdefs%3E%3ClinearGradient id='g' x1='12' y1='4' x2='20' y2='9' gradientUnits='userSpaceOnUse'%3E%3Cstop stop-color='%235b8fff'/%3E%3Cstop offset='1' stop-color='%23a78bfa'/%3E%3C/linearGradient%3E%3C/defs%3E%3C/svg%3E">
<meta name="description" content="Your personal text and command vault. Save snippets, copy in one click.">
<meta name="theme-color" content="#0d0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ClipCopy">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%235b8fff'/%3E%3Cstop offset='100%25' stop-color='%23a78bfa'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='8' fill='url(%23g)'/%3E%3Crect x='10' y='3' width='12' height='6' rx='2' fill='white'/%3E%3Crect x='7' y='7' width='18' height='22' rx='3' fill='rgba(255,255,255,0.15)' stroke='white' stroke-width='1.5'/%3E%3Cline x1='11' y1='16' x2='21' y2='16' stroke='white' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='11' y1='21' x2='18' y2='21' stroke='white' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d0f14;
    --surface: #13161e;
    --surface2: #1a1e28;
    --surface3: #202535;
    --border: rgba(255,255,255,0.06);
    --border-hover: rgba(255,255,255,0.12);
    --accent: #5b8fff;
    --accent2: #a78bfa;
    --accent-glow: rgba(91,143,255,0.25);
    --text: #e8eaf0;
    --text-muted: #6b7280;
    --text-dim: #3d4455;
    --success: #34d399;
    --danger: #f87171;
    --radius: 12px;
    --transition: 0.18s cubic-bezier(0.4,0,0.2,1);
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    overflow-x: hidden;
  }

  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 0 16px 60px;
    background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(91,143,255,0.12) 0%, transparent 60%),
                var(--bg);
  }

  /* ---- HEADER ---- */
  header {
    width: 100%;
    max-width: 680px;
    padding: 36px 0 28px;
    display: flex;
    align-items: center;
    gap: 14px;
    position: relative;
  }

  .logo-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 24px var(--accent-glow);
    flex-shrink: 0;
  }

  .logo-icon svg { width: 20px; height: 20px; }

  .title-group { display: flex; flex-direction: column; gap: 2px; }

  h1 {
    font-size: 22px;
    font-weight: 800;
    letter-spacing: -0.5px;
    background: linear-gradient(90deg, var(--text) 60%, var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
  }

  .subtitle {
    font-size: 11px;
    font-weight: 400;
    color: var(--text-muted);
    letter-spacing: 0.5px;
    font-family: 'DM Mono', monospace;
  }

  .entry-count {
    margin-left: auto;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    background: var(--surface2);
    border: 1px solid var(--border);
    padding: 5px 10px;
    border-radius: 20px;
  }

  /* ---- INPUT AREA ---- */
  .input-section {
    width: 100%;
    max-width: 680px;
    margin-bottom: 20px;
  }

  .input-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: border-color var(--transition), box-shadow var(--transition);
  }

  .input-card:focus-within {
    border-color: rgba(91,143,255,0.35);
    box-shadow: 0 0 0 3px rgba(91,143,255,0.08), 0 4px 20px rgba(0,0,0,0.3);
  }

  .label-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .label-row label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  #title-input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 12px;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    outline: none;
    transition: border-color var(--transition);
  }

  #title-input:focus { border-color: rgba(91,143,255,0.4); }
  #title-input::placeholder { color: var(--text-dim); font-weight: 400; }

  #text-input {
    width: 100%;
    background: transparent;
    border: none;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    outline: none;
    min-height: 70px;
    max-height: 180px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--surface3) transparent;
  }

  #text-input::placeholder { color: var(--text-dim); }

  .input-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }

  .char-count {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
  }

  .btn-add {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 8px 18px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: opacity var(--transition), transform var(--transition), box-shadow var(--transition);
    box-shadow: 0 2px 12px rgba(91,143,255,0.3);
  }

  .btn-add:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(91,143,255,0.4); }
  .btn-add:active { transform: scale(0.97); }

  /* ---- SEARCH + FILTER ---- */
  .toolbar {
    width: 100%;
    max-width: 680px;
    display: flex;
    gap: 10px;
    margin-bottom: 14px;
    align-items: center;
  }

  .search-wrap {
    flex: 1;
    position: relative;
  }

  .search-wrap svg {
    position: absolute;
    left: 11px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-dim);
    pointer-events: none;
  }

  #search-input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 12px 9px 34px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    outline: none;
    transition: border-color var(--transition);
  }

  #search-input:focus { border-color: rgba(91,143,255,0.4); }
  #search-input::placeholder { color: var(--text-dim); }

  /* ---- LIST ---- */
  .list-section {
    width: 100%;
    max-width: 680px;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-dim);
  }

  .empty-state svg { width: 40px; height: 40px; margin: 0 auto 14px; display: block; opacity: 0.3; }
  .empty-state p { font-size: 14px; color: var(--text-muted); margin-bottom: 6px; }
  .empty-state span { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-dim); }

  #entries-list { list-style: none; display: flex; flex-direction: column; gap: 8px; }

  /* ---- ENTRY CARD ---- */
  .entry {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    transition: border-color var(--transition), background var(--transition), transform var(--transition), box-shadow var(--transition);
    position: relative;
    overflow: hidden;
    user-select: none;
    animation: slideIn 0.22s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .entry:hover {
    border-color: var(--border-hover);
    background: var(--surface2);
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }

  .entry.dragging {
    opacity: 0.4;
    transform: scale(0.98);
  }

  .entry.drag-over {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--accent-glow);
  }

  /* Ripple / copy flash */
  .entry.copied {
    border-color: var(--success) !important;
    box-shadow: 0 0 0 3px rgba(52,211,153,0.15), 0 0 20px rgba(52,211,153,0.1) !important;
  }

  .entry::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(52,211,153,0.18) 0%, transparent 70%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }

  .entry.copied::after { opacity: 1; }

  .drag-handle {
    color: var(--text-dim);
    cursor: grab;
    margin-top: 2px;
    flex-shrink: 0;
    transition: color var(--transition);
  }

  .entry:hover .drag-handle { color: var(--text-muted); }
  .drag-handle:active { cursor: grabbing; }

  .entry-body { flex: 1; min-width: 0; }

  .entry-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    letter-spacing: -0.2px;
  }

  .entry-title:empty { display: none; }

  .entry-preview {
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-all;
  }

  .entry-actions {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
    opacity: 0;
    transition: opacity var(--transition);
  }

  .entry:hover .entry-actions { opacity: 1; }

  .icon-btn {
    background: var(--surface3);
    border: 1px solid var(--border);
    border-radius: 7px;
    width: 30px; height: 30px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    color: var(--text-muted);
    transition: background var(--transition), color var(--transition), transform var(--transition);
    flex-shrink: 0;
  }

  .icon-btn:hover { background: var(--surface2); color: var(--text); transform: scale(1.05); }
  .icon-btn.delete:hover { color: var(--danger); border-color: rgba(248,113,113,0.3); background: rgba(248,113,113,0.08); }
  .icon-btn.copy-btn:hover { color: var(--success); border-color: rgba(52,211,153,0.3); background: rgba(52,211,153,0.08); }

  .copy-toast {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    background: var(--success);
    color: #0d0f14;
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 800;
    letter-spacing: 0.5px;
    padding: 5px 12px;
    border-radius: 20px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s, transform 0.2s;
    z-index: 10;
    white-space: nowrap;
  }

  .entry.copied .copy-toast {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  /* ---- EDIT MODAL ---- */
  .overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(6px);
    display: flex; align-items: center; justify-content: center;
    z-index: 100;
    opacity: 0; pointer-events: none;
    transition: opacity 0.2s;
  }

  .overlay.open { opacity: 1; pointer-events: all; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border-hover);
    border-radius: 16px;
    padding: 24px;
    width: 100%;
    max-width: 500px;
    margin: 16px;
    transform: scale(0.95) translateY(10px);
    transition: transform 0.2s cubic-bezier(0.4,0,0.2,1);
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }

  .overlay.open .modal { transform: scale(1) translateY(0); }

  .modal h2 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--text);
    display: flex; align-items: center; gap: 8px;
  }

  .modal-field { margin-bottom: 12px; }
  .modal-field label { display: block; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 6px; }

  .modal-field input,
  .modal-field textarea {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    outline: none;
    transition: border-color var(--transition);
    resize: vertical;
  }

  .modal-field input { font-family: 'Syne', sans-serif; font-weight: 600; }
  .modal-field input:focus, .modal-field textarea:focus { border-color: rgba(91,143,255,0.5); }

  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px; }

  .btn-secondary {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 16px;
    color: var(--text-muted);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
  }

  .btn-secondary:hover { border-color: var(--border-hover); color: var(--text); }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 8px;
    padding: 8px 18px;
    color: #fff;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: opacity var(--transition), transform var(--transition);
    box-shadow: 0 2px 10px rgba(91,143,255,0.3);
  }

  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }

  /* ---- GLOBAL TOAST ---- */
  #global-toast {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--surface3);
    border: 1px solid var(--border-hover);
    border-radius: 20px;
    padding: 9px 18px;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    color: var(--text);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s, transform 0.2s;
    z-index: 999;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }

  #global-toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  #global-toast .toast-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--success);
    box-shadow: 0 0 8px var(--success);
  }

  /* ---- HELP BUTTON ---- */
  .help-btn {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text-dim);
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all var(--transition);
    flex-shrink: 0;
  }
  .help-btn:hover { border-color: var(--border-hover); color: var(--text-muted); background: var(--surface3); }

  /* ---- SHORTCUTS MODAL ---- */
  .shortcuts-grid {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 4px;
  }

  .shortcut-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--surface2);
    border-radius: 8px;
    border: 1px solid var(--border);
    gap: 16px;
  }

  .shortcut-label {
    font-size: 12px;
    color: var(--text-muted);
    flex: 1;
  }

  .shortcut-keys {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  kbd {
    background: var(--surface3);
    border: 1px solid var(--border-hover);
    border-radius: 5px;
    padding: 3px 7px;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text);
    line-height: 1;
    box-shadow: 0 1px 0 rgba(255,255,255,0.06);
  }

  .shortcut-plus {
    font-size: 10px;
    color: var(--text-dim);
  }

  .shortcut-section-title {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 12px;
    margin-bottom: 4px;
    padding-left: 2px;
  }

  .shortcut-section-title:first-child { margin-top: 0; }

  /* scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--surface3); border-radius: 4px; }
</style>
</head>
<body>

<header>
  <div class="logo-icon">
    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="9" y="2" width="6" height="4" rx="1"/>
      <path d="M17 4h2a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
      <path d="M9 12h6M9 16h4"/>
    </svg>
  </div>
  <div class="title-group">
    <h1>ClipCopy App</h1>
    <span class="subtitle">// your text command vault</span>
  </div>
  <div class="entry-count" id="entry-count">0 entries</div>
  <button class="help-btn" onclick="document.getElementById('help-overlay').classList.add('open')" title="Keyboard shortcuts">?</button>
</header>

<div class="input-section">
  <div class="input-card">
    <div class="label-row">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" style="color:var(--accent)">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      <label>New Entry</label>
    </div>
    <input type="text" id="title-input" placeholder="Label or titleâ€¦" maxlength="60" autocomplete="off" spellcheck="false">
    <textarea id="text-input" placeholder="Paste your command, snippet, or text hereâ€¦" spellcheck="false"></textarea>
    <div class="input-footer">
      <span class="char-count" id="char-count">0 chars</span>
      <button class="btn-add" onclick="addEntry()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg>
        Save Entry
      </button>
    </div>
  </div>
</div>

<div class="toolbar">
  <div class="search-wrap">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    <input type="text" id="search-input" placeholder="Search entriesâ€¦" autocomplete="off" spellcheck="false" oninput="renderList()">
  </div>
</div>

<div class="list-section">
  <div class="empty-state" id="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
      <rect x="9" y="2" width="6" height="4" rx="1"/>
      <path d="M17 4h2a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
      <path d="M9 12h6M9 16h4"/>
    </svg>
    <p>No entries yet</p>
    <span>Add your first command or snippet above</span>
  </div>
  <ul id="entries-list"></ul>
</div>

<!-- Shortcuts Modal -->
<div class="overlay" id="help-overlay" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="modal" style="max-width:420px;">
    <h2>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 8h.01M7 12h.01M7 16h.01M11 8h6M11 12h4M11 16h2"/></svg>
      Keyboard Shortcuts
    </h2>

    <div class="shortcuts-grid">
      <div class="shortcut-section-title">Saving</div>

      <div class="shortcut-row">
        <span class="shortcut-label">Save new entry</span>
        <span class="shortcut-keys"><kbd>Ctrl</kbd><span class="shortcut-plus">+</span><kbd>Enter</kbd></span>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-label">Save from text field</span>
        <span class="shortcut-keys"><kbd>Shift</kbd><span class="shortcut-plus">+</span><kbd>Enter</kbd></span>
      </div>

      <div class="shortcut-section-title">Navigation &amp; Actions</div>

      <div class="shortcut-row">
        <span class="shortcut-label">Copy entry to clipboard</span>
        <span class="shortcut-keys"><kbd>Click</kbd></span>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-label">Close modal / dialog</span>
        <span class="shortcut-keys"><kbd>Esc</kbd></span>
      </div>

      <div class="shortcut-section-title">Organisation</div>

      <div class="shortcut-row">
        <span class="shortcut-label">Reorder entries</span>
        <span class="shortcut-keys"><kbd>â ¿ Drag</kbd></span>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-label">Edit entry</span>
        <span class="shortcut-keys"><kbd>Hover</kbd><span class="shortcut-plus">â†’</span><kbd>âœŽ</kbd></span>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-label">Delete entry</span>
        <span class="shortcut-keys"><kbd>Hover</kbd><span class="shortcut-plus">â†’</span><kbd>ðŸ—‘</kbd></span>
      </div>
    </div>

    <div class="modal-actions" style="margin-top:20px;">
      <button class="btn-primary" onclick="document.getElementById('help-overlay').classList.remove('open')">Got it</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="overlay" id="edit-overlay" onclick="closeModal(event)">
  <div class="modal">
    <h2>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Edit Entry
    </h2>
    <div class="modal-field">
      <label>Title</label>
      <input type="text" id="edit-title" maxlength="60" autocomplete="off" spellcheck="false">
    </div>
    <div class="modal-field">
      <label>Content</label>
      <textarea id="edit-text" rows="6" spellcheck="false"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn-primary" onclick="saveEdit()">Save Changes</button>
    </div>
  </div>
</div>

<!-- Global Toast -->
<div id="global-toast"><span class="toast-dot"></span><span id="toast-msg">Copied!</span></div>

<footer style="position:fixed;bottom:10px;right:16px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:0.3px;pointer-events:none;user-select:none;">crafted by Amr Alaa</footer>

<script>
  const STORAGE_KEY = 'clipcopy_entries_v1';
  let entries = [];
  let editingId = null;
  let dragSrcIndex = null;
  let toastTimer = null;

  // Load
  function load() {
    try {
      entries = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch { entries = []; }
    renderList();
  }

  // Save
  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    updateCount();
  }

  function updateCount() {
    const c = entries.length;
    document.getElementById('entry-count').textContent = `${c} ${c === 1 ? 'entry' : 'entries'}`;
  }

  // Char count
  document.getElementById('text-input').addEventListener('input', function() {
    document.getElementById('char-count').textContent = this.value.length + ' chars';
  });

  // Add entry
  function addEntry() {
    const title = document.getElementById('title-input').value.trim();
    const text = document.getElementById('text-input').value.trim();
    if (!text) { flashInput(); return; }
    const entry = {
      id: Date.now().toString(),
      title: title,
      text,
      created: Date.now()
    };
    entries.unshift(entry);
    save();
    document.getElementById('title-input').value = '';
    document.getElementById('text-input').value = '';
    document.getElementById('char-count').textContent = '0 chars';
    renderList();
  }

  function flashInput() {
    const ta = document.getElementById('text-input');
    ta.style.borderColor = 'rgba(248,113,113,0.5)';
    setTimeout(() => ta.style.borderColor = '', 600);
  }

  // Render
  function renderList() {
    const q = document.getElementById('search-input').value.toLowerCase();
    const filtered = q
      ? entries.filter(e => e.title.toLowerCase().includes(q) || e.text.toLowerCase().includes(q))
      : entries;

    const list = document.getElementById('entries-list');
    const empty = document.getElementById('empty-state');

    if (filtered.length === 0) {
      empty.style.display = 'block';
      list.innerHTML = '';
      return;
    }

    empty.style.display = 'none';
    list.innerHTML = '';

    filtered.forEach((entry, idx) => {
      const realIdx = entries.indexOf(entry);
      const li = document.createElement('li');
      li.className = 'entry';
      li.dataset.id = entry.id;
      li.dataset.index = realIdx;
      li.draggable = true;
      li.innerHTML = `
        <div class="drag-handle" title="Drag to reorder">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <circle cx="9" cy="5" r="1.5" fill="currentColor"/>
            <circle cx="15" cy="5" r="1.5" fill="currentColor"/>
            <circle cx="9" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="15" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="9" cy="19" r="1.5" fill="currentColor"/>
            <circle cx="15" cy="19" r="1.5" fill="currentColor"/>
          </svg>
        </div>
        <div class="entry-body">
          <div class="entry-title">${escHtml(entry.title)}</div>
          <div class="entry-preview">${escHtml(entry.text)}</div>
        </div>
        <div class="entry-actions" onclick="event.stopPropagation()">
          <button class="icon-btn copy-btn" title="Copy" onclick="copyEntry('${entry.id}', this)">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
              <rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
            </svg>
          </button>
          <button class="icon-btn" title="Edit" onclick="openEdit('${entry.id}')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/>
            </svg>
          </button>
          <button class="icon-btn delete" title="Delete" onclick="deleteEntry('${entry.id}')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
              <polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/>
            </svg>
          </button>
        </div>
        <div class="copy-toast">âœ“ Copied!</div>
      `;

      // Click to copy (not on actions)
      li.addEventListener('click', function(e) {
        if (e.target.closest('.entry-actions') || e.target.closest('.drag-handle')) return;
        copyEntry(entry.id, null, li);
      });

      // Drag events
      li.addEventListener('dragstart', onDragStart);
      li.addEventListener('dragover', onDragOver);
      li.addEventListener('dragleave', onDragLeave);
      li.addEventListener('drop', onDrop);
      li.addEventListener('dragend', onDragEnd);

      list.appendChild(li);
    });
  }

  // Copy
  async function copyEntry(id, btn, liEl) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;

    try {
      await navigator.clipboard.writeText(entry.text);
    } catch {
      const ta = document.createElement('textarea');
      ta.value = entry.text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
    }

    // Visual feedback
    const li = liEl || document.querySelector(`[data-id="${id}"]`);
    if (li) {
      li.classList.add('copied');
      setTimeout(() => li.classList.remove('copied'), 1200);
    }

    // If triggered from copy btn, also pulse it
    if (btn) {
      btn.style.color = 'var(--success)';
      setTimeout(() => btn.style.color = '', 1000);
    }

    showToast(`Copied: ${entry.title}`);
  }

  // Toast
  function showToast(msg) {
    const toast = document.getElementById('global-toast');
    document.getElementById('toast-msg').textContent = msg;
    toast.classList.add('show');
    if (toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove('show'), 2200);
  }

  // Delete
  function deleteEntry(id) {
    const li = document.querySelector(`[data-id="${id}"]`);
    if (li) {
      li.style.transform = 'scale(0.95)';
      li.style.opacity = '0';
      li.style.transition = 'all 0.2s ease';
      setTimeout(() => {
        entries = entries.filter(e => e.id !== id);
        save();
        renderList();
      }, 180);
    }
  }

  // Edit Modal
  function openEdit(id) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;
    editingId = id;
    document.getElementById('edit-title').value = entry.title;
    document.getElementById('edit-text').value = entry.text;
    document.getElementById('edit-overlay').classList.add('open');
  }

  function closeModal(e) {
    if (e && e.target !== document.getElementById('edit-overlay')) return;
    document.getElementById('edit-overlay').classList.remove('open');
    editingId = null;
  }

  function saveEdit() {
    if (!editingId) return;
    const idx = entries.findIndex(e => e.id === editingId);
    if (idx === -1) return;
    entries[idx].title = document.getElementById('edit-title').value.trim();
    entries[idx].text = document.getElementById('edit-text').value.trim();
    save();
    renderList();
    document.getElementById('edit-overlay').classList.remove('open');
    editingId = null;
    showToast('Entry updated');
  }

  // Escape
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeModal({target: document.getElementById('edit-overlay')});
      document.getElementById('help-overlay').classList.remove('open');
    }
    if (e.key === '?' && !e.target.closest('input, textarea')) document.getElementById('help-overlay').classList.add('open');
    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey) && !document.getElementById('edit-overlay').classList.contains('open')) addEntry();
  });

  // Drag & Drop
  function onDragStart(e) {
    dragSrcIndex = parseInt(this.dataset.index);
    this.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
  }

  function onDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    document.querySelectorAll('.entry').forEach(el => el.classList.remove('drag-over'));
    this.classList.add('drag-over');
  }

  function onDragLeave() { this.classList.remove('drag-over'); }

  function onDrop(e) {
    e.preventDefault();
    const targetIndex = parseInt(this.dataset.index);
    if (dragSrcIndex === null || dragSrcIndex === targetIndex) return;
    const moved = entries.splice(dragSrcIndex, 1)[0];
    entries.splice(targetIndex, 0, moved);
    save();
    renderList();
  }

  function onDragEnd() {
    document.querySelectorAll('.entry').forEach(el => {
      el.classList.remove('dragging', 'drag-over');
    });
    dragSrcIndex = null;
  }

  // Helpers
  function escHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // Enter to save entry
  document.getElementById('text-input').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && e.shiftKey) {
      e.preventDefault();
      addEntry();
    }
  });

  load();

  // ---- PWA SETUP ----
  (function setupPWA() {
    // 1. Draw icon on canvas â†’ base64 PNG
    function makeIcon(size) {
      const c = document.createElement('canvas');
      c.width = c.height = size;
      const ctx = c.getContext('2d');
      const r = size * 0.25;
      // rounded rect background
      const grad = ctx.createLinearGradient(0, 0, size, size);
      grad.addColorStop(0, '#5b8fff');
      grad.addColorStop(1, '#a78bfa');
      ctx.beginPath();
      ctx.moveTo(r, 0); ctx.lineTo(size - r, 0);
      ctx.quadraticCurveTo(size, 0, size, r);
      ctx.lineTo(size, size - r);
      ctx.quadraticCurveTo(size, size, size - r, size);
      ctx.lineTo(r, size); ctx.quadraticCurveTo(0, size, 0, size - r);
      ctx.lineTo(0, r); ctx.quadraticCurveTo(0, 0, r, 0);
      ctx.closePath();
      ctx.fillStyle = grad;
      ctx.fill();
      // clipboard body
      const m = size * 0.22, bw = size - m * 2, bh = size * 0.69;
      const by = size * 0.22;
      const br = size * 0.09;
      ctx.fillStyle = 'rgba(255,255,255,0.15)';
      ctx.strokeStyle = 'rgba(255,255,255,0.9)';
      ctx.lineWidth = size * 0.05;
      ctx.beginPath();
      ctx.moveTo(m + br, by); ctx.lineTo(m + bw - br, by);
      ctx.quadraticCurveTo(m + bw, by, m + bw, by + br);
      ctx.lineTo(m + bw, by + bh - br);
      ctx.quadraticCurveTo(m + bw, by + bh, m + bw - br, by + bh);
      ctx.lineTo(m + br, by + bh); ctx.quadraticCurveTo(m, by + bh, m, by + bh - br);
      ctx.lineTo(m, by + br); ctx.quadraticCurveTo(m, by, m + br, by);
      ctx.closePath();
      ctx.fill(); ctx.stroke();
      // clip tab
      const tw = size * 0.38, th = size * 0.18;
      const tx = (size - tw) / 2, ty = size * 0.09;
      ctx.fillStyle = 'rgba(255,255,255,0.95)';
      ctx.beginPath();
      ctx.moveTo(tx + th/2, ty); ctx.lineTo(tx + tw - th/2, ty);
      ctx.quadraticCurveTo(tx + tw, ty, tx + tw, ty + th/2);
      ctx.lineTo(tx + tw, ty + th - th/2);
      ctx.quadraticCurveTo(tx + tw, ty + th, tx + tw - th/2, ty + th);
      ctx.lineTo(tx + th/2, ty + th); ctx.quadraticCurveTo(tx, ty + th, tx, ty + th - th/2);
      ctx.lineTo(tx, ty + th/2); ctx.quadraticCurveTo(tx, ty, tx + th/2, ty);
      ctx.closePath();
      ctx.fill();
      // lines
      ctx.strokeStyle = 'rgba(255,255,255,0.9)';
      ctx.lineWidth = size * 0.055;
      ctx.lineCap = 'round';
      const lx1 = m + size * 0.12, lx2 = m + bw - size * 0.12;
      ctx.beginPath(); ctx.moveTo(lx1, size * 0.56); ctx.lineTo(lx2, size * 0.56); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(lx1, size * 0.69); ctx.lineTo(lx1 + (lx2-lx1)*0.55, size * 0.69); ctx.stroke();
      return c.toDataURL('image/png');
    }

    const icon192 = makeIcon(192);
    const icon512 = makeIcon(512);

    // 2. Build manifest blob
    const manifest = {
      name: 'ClipCopy App',
      short_name: 'ClipCopy',
      description: 'Your personal text and command vault.',
      start_url: '.',
      display: 'standalone',
      background_color: '#0d0f14',
      theme_color: '#0d0f14',
      orientation: 'portrait-primary',
      icons: [
        { src: icon192, sizes: '192x192', type: 'image/png', purpose: 'any maskable' },
        { src: icon512, sizes: '512x512', type: 'image/png', purpose: 'any maskable' }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    const manifestLink = document.createElement('link');
    manifestLink.rel = 'manifest';
    manifestLink.href = manifestURL;
    document.head.appendChild(manifestLink);

    // Apple touch icon
    const appleLink = document.createElement('link');
    appleLink.rel = 'apple-touch-icon';
    appleLink.href = icon192;
    document.head.appendChild(appleLink);

    // 3. Service worker via blob for offline support
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE = 'clipcopy-v1';
        const ASSETS = [self.location.href.replace(/\\/sw-blob.*/, '')];

        self.addEventListener('install', e => {
          e.waitUntil(
            caches.open(CACHE).then(cache =>
              fetch(location.href).then(r => cache.put('clipcopy-app', r)).catch(() => {})
            )
          );
          self.skipWaiting();
        });

        self.addEventListener('activate', e => {
          e.waitUntil(
            caches.keys().then(keys =>
              Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
            )
          );
          self.clients.claim();
        });

        self.addEventListener('fetch', e => {
          e.respondWith(
            fetch(e.request).catch(() => caches.match('clipcopy-app'))
          );
        });
      `;
      const swBlob = new Blob([swCode], { type: 'application/javascript' });
      const swURL = URL.createObjectURL(swBlob);
      navigator.serviceWorker.register(swURL, { scope: './' })
        .catch(() => {}); // silently fail if blocked (e.g. file:// protocol)
    }
  })();
</script>
</body>
</html>
